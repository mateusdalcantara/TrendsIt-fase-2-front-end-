<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrendsIT - Home</title>
    
    <!-- CSS Links -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/profile.css">
    <link rel="stylesheet" href="css/events.css">
    <link rel="stylesheet" href="css/mobile.css">
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <script>
        // Authentication check
        if (!localStorage.getItem('token')) {
            window.location.href = 'index.html';
        }
    </script>

    <nav class="main-nav" role="navigation">
        <div class="brand" role="banner">TrendsIT</div>
        <div class="nav-links">
            <button id="logoutBtn" aria-label="Logout">Logout</button>
            <button id="createPostBtn" aria-label="Create new post">+ New Post</button>
            <button id="createEventBtn" aria-label="Create new event">+ New Event</button>
            <button id="profileBtn" aria-label="Your profile"><i class="fas fa-user"></i></button>
        </div>
    </nav>

    <main class="container">
        <aside class="sidebar" role="complementary">
            <nav>
                <ul role="menu">
                    <li role="menuitem"><a href="home.html" class="active"><i class="fas fa-home"></i> Feed</a></li>
                    <li role="menuitem"><a href="directory.html"><i class="fas fa-users"></i> Directory</a></li>
                    <li role="menuitem"><a href="groups.html"><i class="fas fa-user-friends"></i> Groups</a></li>
                    <li role="menuitem"><a href="calendar.html"><i class="fas fa-calendar-alt"></i> Calendar</a></li>
                    <li role="menuitem"><a href="jobs.html"><i class="fas fa-briefcase"></i> Jobs</a></li>
                    <li role="menuitem"><a href="training.html"><i class="fas fa-graduation-cap"></i> Training</a></li>
                    <li role="menuitem"><a href="residency.html"><i class="fas fa-hospital"></i> Residency</a></li>
                </ul>
            </nav>
        </aside>

        <section class="content" role="main">
            <div class="posts-container" id="postsContainer" role="feed">
                <!-- Posts loaded dynamically -->
            </div>
        </section>
    </main>

    <!-- MODALS SECTION -->
    <div class="modal" id="postModal" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="modal-content">
            <h3 id="postModalTitle">Create New Post</h3>
            <form id="postForm">
                <input type="text" placeholder="Title" id="postTitle" required aria-labelledby="postModalTitle">
                <textarea placeholder="Content" id="postContent" rows="4" required></textarea>
                <button type="submit" class="btn-primary">Publish</button>
            </form>
        </div>
    </div>

    <div class="modal" id="profileModal" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="modal-content">
            <h3 id="profileModalTitle">Your Profile</h3>
            <form id="profileForm">
                <input type="text" id="profileUsername" placeholder="Username" required aria-labelledby="profileModalTitle">
                <input type="email" id="profileEmail" placeholder="Email" required>
                <button type="submit" class="btn-primary">Save Changes</button>
            </form>
        </div>
    </div>

    <div class="modal" id="eventModal" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="modal-content">
            <h3 id="eventModalTitle">New Event</h3>
            <form id="eventForm">
                <input type="text" id="eventTitle" placeholder="Event Title" required aria-labelledby="eventModalTitle">
                <textarea id="eventDescription" placeholder="Event Description" required></textarea>
                <input type="datetime-local" id="eventDate" required>
                <button type="submit" class="btn-primary">Create Event</button>
            </form>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    
    <!-- Application Scripts -->
    <script src="js/api.js"></script>
    <script src="js/errorHandler.js"></script>
    <script src="js/home.js"></script>
    <script src="js/profile.js"></script>
    <script src="js/events.js"></script>

    <!-- Enhanced Inline Scripts -->
    <script>
        // Initialize error handling
        ErrorHandler.init();

        // Modal Management System
        const modalManager = {
            openModal: (modalId) => {
                const modal = document.getElementById(modalId);
                modal.style.display = 'flex';
                modal.setAttribute('aria-hidden', 'false');
                modal.querySelector('input, button').focus();
            },
            
            closeModal: (modalId) => {
                const modal = document.getElementById(modalId);
                modal.style.display = 'none';
                modal.setAttribute('aria-hidden', 'true');
            }
        };

        // Event Listeners
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('token');
            window.location.href = 'index.html';
        });

        document.getElementById('profileBtn').addEventListener('click', () => {
            modalManager.openModal('profileModal');
        });

        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modalManager.closeModal(modal.id);
            });

            modal.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') modalManager.closeModal(modal.id);
                
                const focusable = modal.querySelectorAll(
                    'button, input, textarea, [tabindex]:not([tabindex="-1"])'
                );
                
                if (focusable.length > 0) {
                    const firstElement = focusable[0];
                    const lastElement = focusable[focusable.length - 1];

                    if (e.key === 'Tab') {
                        if (e.shiftKey && document.activeElement === firstElement) {
                            lastElement.focus();
                            e.preventDefault();
                        } else if (!e.shiftKey && document.activeElement === lastElement) {
                            firstElement.focus();
                            e.preventDefault();
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>